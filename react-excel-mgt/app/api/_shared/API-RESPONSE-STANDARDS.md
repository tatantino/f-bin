# API 响应格式标准

本文档定义了项目中所有 API 端点的标准响应格式，确保整个系统的一致性和可预测性。

## 成功响应标准

所有成功的 API 响应都使用 HTTP 状态码 **200 OK**，并遵循以下响应格式标准：

### 1. GET 操作

用于查询或检索数据的操作。

#### 单一资源响应格式：

```json
{
  "field1": "value1",
  "field2": "value2",
  ...
}
```

#### 集合资源响应格式：

```json
[
  {
    "field1": "value1",
    "field2": "value2",
    ...
  },
  {
    "field1": "value3",
    "field2": "value4",
    ...
  }
]
```

### 2. POST 操作（创建）

用于创建新资源的操作。

#### 标准响应格式：

```json
{
  "id": "resource_id"
}
```

- 其中 `id` 是新创建资源的唯一标识符

#### 特例 - 批量操作响应：

对于批量操作（如 tanks 的批量创建），使用：

```json
{
  "count": 42
}
```

- 其中 `count` 表示成功处理的记录数量

### 3. PATCH 操作（更新）

用于更新现有资源的操作。

#### 标准响应格式：

```json
{
  "id": "resource_id"
}
```

- 其中 `id` 是已更新资源的唯一标识符

### 4. DELETE 操作（删除）

用于删除资源的操作。

#### 标准响应格式：

```json
{
  "id": "resource_id"
}
```

- 其中 `id` 是已删除资源的唯一标识符

### 5. 空响应

对于某些不需要返回任何数据的操作（如某些 POST 操作），可以返回空对象：

```json
{}
```

## 错误响应标准

所有错误响应都遵循以下格式，并使用适当的 HTTP 状态码（4xx 或 5xx）：

```json
{
  "message": "错误描述信息"
}
```

### 常用 HTTP 错误状态码

- **400 Bad Request**: 请求参数错误或格式不正确
- **401 Unauthorized**: 未提供有效的身份验证凭证
- **403 Forbidden**: 身份验证成功但没有权限访问请求的资源
- **404 Not Found**: 请求的资源不存在
- **409 Conflict**: 资源状态冲突，请求无法完成
- **500 Internal Server Error**: 服务器内部错误

## 分页响应（可选）

对于支持分页的 GET 请求，响应格式如下：

```json
{
  "data": [
    {
      "field1": "value1",
      "field2": "value2",
      ...
    },
    ...
  ],
  "pagination": {
    "page": 2,
    "limit": 50,
    "totalItems": 327,
    "totalPages": 7
  }
}
```

## 最佳实践

1. **始终使用正确的 HTTP 状态码**：使用 200 表示成功，4xx/5xx 表示错误
2. **保持响应格式一致**：为每种操作类型保持一致的响应结构
3. **最小化响应数据**：只返回必要的信息，避免过多的嵌套或冗余数据
4. **处理错误明确**：提供清晰、具体的错误信息和适当的状态码

## 实现说明

在项目中，这些响应标准通过以下机制实现：

1. **handleApiRequest 工具函数**：用于统一处理成功响应和错误处理
2. **服务层返回值标准化**：确保服务方法返回的数据符合以上标准格式
3. **统一错误处理**：使用 withErrorHandling 包装服务方法以确保一致的错误处理

通过遵循这些标准，我们可以确保整个 API 层的响应格式保持一致，提高代码可维护性和前端开发的便捷性。
